<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Seller Profile - AgriGorithm</title>
    <link rel="stylesheet" href="../css/main.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
</head>
<body class="bg-background min-h-screen">
    <!-- Header -->
    <header class="bg-surface-raised border-b border-border sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <!-- Back Navigation -->
                <div class="flex items-center space-x-4">
                    <button onclick="history.back()" class="flex items-center text-text-secondary hover:text-primary transition-colors duration-200" aria-label="Go back">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                        </svg>
                        Back
                    </button>
                </div>

                <!-- Logo and Search -->
                <div class="flex-1 flex items-center justify-center space-x-4">
                    <a href="home_screen.html" class="flex items-center">
                        <svg class="w-8 h-8 text-primary mr-2" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
                        </svg>
                        <span class="text-xl font-bold text-text-primary">AgriGorithm</span>
                    </a>
                    
                    <!-- Search Bar -->
                    <div class="relative max-w-md w-full">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <svg class="h-4 w-4 text-text-tertiary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                            </svg>
                        </div>
                        <input 
                            id="search-products" 
                            type="text" 
                            placeholder="Search products..." 
                            class="block w-full pl-10 pr-3 py-2 border border-border rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-all duration-200 text-sm"
                        >
                    </div>
                </div>

                <!-- Profile Button -->
                <div class="flex items-center">
                    <a href="login_profile_screen.html" class="flex items-center space-x-2 text-text-secondary hover:text-primary transition-colors duration-200 p-2 rounded-lg hover:bg-surface">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                        </svg>
                        <span class="hidden sm:block font-medium">Profile</span>
                    </a>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Seller Profile Section -->
        <div id="seller-profile" class="bg-surface-raised rounded-lg border border-border overflow-hidden mb-8">
            <!-- Profile Loading Skeleton -->
            <div id="profile-skeleton" class="animate-pulse">
                <div class="h-32 bg-surface"></div>
                <div class="p-6">
                    <div class="flex items-start space-x-4">
                        <div class="w-16 h-16 bg-surface rounded-full"></div>
                        <div class="flex-1 space-y-3">
                            <div class="h-6 bg-surface rounded w-1/3"></div>
                            <div class="h-4 bg-surface rounded w-1/2"></div>
                            <div class="h-4 bg-surface rounded w-3/4"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Actual Profile Content -->
            <div id="profile-content" class="hidden">
                <!-- Profile content will be populated here -->
            </div>
        </div>

        <!-- Products Section -->
        <div class="mb-8">
            <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between mb-6 space-y-4 lg:space-y-0">
                <div>
                    <h2 class="text-2xl font-bold text-text-primary">Products by this Seller</h2>
                    <p class="text-text-secondary">Browse all available products from this producer</p>
                </div>
                
                <!-- Sort Controls -->
                <div class="flex items-center space-x-4">
                    <span class="text-sm font-medium text-text-secondary whitespace-nowrap">Sort by:</span>
                    <div class="relative">
                        <label for="sort-select" class="sr-only">Sort products</label>
                        <select id="sort-select" class="input-field pr-8 appearance-none bg-white min-w-0">
                            <option value="newest">Newest First</option>
                            <option value="price-low">Price (Low-High)</option>
                            <option value="price-high">Price (High-Low)</option>
                        </select>
                        <svg class="absolute right-2 top-1/2 transform -translate-y-1/2 w-4 h-4 text-text-tertiary pointer-events-none" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                        </svg>
                    </div>
                </div>
            </div>

            <!-- Products Grid -->
            <div id="products-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 mb-8">
                <!-- Product cards will be dynamically inserted here -->
            </div>

            <!-- Products Loading Skeleton -->
            <div id="products-skeleton" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 mb-8">
                <!-- Skeleton cards -->
                <div class="bg-surface-raised rounded-lg border border-border overflow-hidden animate-pulse">
                    <div class="aspect-square bg-surface"></div>
                    <div class="p-4 space-y-3">
                        <div class="h-4 bg-surface rounded w-3/4"></div>
                        <div class="h-3 bg-surface rounded w-1/2"></div>
                        <div class="h-4 bg-surface rounded w-1/4"></div>
                    </div>
                </div>
                <div class="bg-surface-raised rounded-lg border border-border overflow-hidden animate-pulse">
                    <div class="aspect-square bg-surface"></div>
                    <div class="p-4 space-y-3">
                        <div class="h-4 bg-surface rounded w-3/4"></div>
                        <div class="h-3 bg-surface rounded w-1/2"></div>
                        <div class="h-4 bg-surface rounded w-1/4"></div>
                    </div>
                </div>
                <div class="bg-surface-raised rounded-lg border border-border overflow-hidden animate-pulse">
                    <div class="aspect-square bg-surface"></div>
                    <div class="p-4 space-y-3">
                        <div class="h-4 bg-surface rounded w-3/4"></div>
                        <div class="h-3 bg-surface rounded w-1/2"></div>
                        <div class="h-4 bg-surface rounded w-1/4"></div>
                    </div>
                </div>
                <div class="bg-surface-raised rounded-lg border border-border overflow-hidden animate-pulse">
                    <div class="aspect-square bg-surface"></div>
                    <div class="p-4 space-y-3">
                        <div class="h-4 bg-surface rounded w-3/4"></div>
                        <div class="h-3 bg-surface rounded w-1/2"></div>
                        <div class="h-4 bg-surface rounded w-1/4"></div>
                    </div>
                </div>
            </div>

            <!-- Empty State -->
            <div id="empty-state" class="hidden text-center py-16">
                <div class="max-w-md mx-auto">
                    <svg class="w-16 h-16 text-text-tertiary mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path>
                    </svg>
                    <h3 class="text-xl font-semibold text-text-primary mb-2">No products available</h3>
                    <p class="text-text-secondary mb-6">This seller doesn't have any products listed at the moment. Check back later for new additions.</p>
                    <a href="products_listing_screen.html" class="btn-primary">Browse Other Products</a>
                </div>
            </div>

            <!-- Loading Indicator -->
            <div id="loading-indicator" class="hidden flex items-center justify-center py-8">
                <div class="flex items-center space-x-2">
                    <svg class="animate-spin h-5 w-5 text-primary" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    <span class="text-sm text-text-secondary">Loading products...</span>
                </div>
            </div>
        </div>

        <!-- Error State -->
        <div id="error-state" class="hidden max-w-md mx-auto mt-16 text-center">
            <div class="bg-surface-raised rounded-lg p-8 border border-border">
                <svg class="w-16 h-16 text-text-tertiary mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                <h2 class="text-xl font-semibold text-text-primary mb-2">Something went wrong</h2>
                <p class="text-text-secondary mb-6">We couldn't load the seller information. Please try again.</p>
                <button id="retry-btn" class="btn-primary">Try Again</button>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-surface-raised border-t border-border mt-16">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                <div class="space-y-4">
                    <div class="flex items-center">
                        <svg class="w-8 h-8 text-primary mr-2" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
                        </svg>
                        <span class="text-xl font-bold text-text-primary">AgriGorithm</span>
                    </div>
                    <p class="text-text-secondary">Connecting farmers with consumers for fresh, sustainable produce.</p>
                </div>
                
                <div>
                    <h3 class="font-semibold text-text-primary mb-4">Quick Links</h3>
                    <ul class="space-y-2">
                        <li><a href="home_screen.html" class="text-text-secondary hover:text-primary transition-colors duration-200">Home</a></li>
                        <li><a href="products_listing_screen.html" class="text-text-secondary hover:text-primary transition-colors duration-200">Products</a></li>
                        <li><a href="#" class="text-text-secondary hover:text-primary transition-colors duration-200">About</a></li>
                        <li><a href="#" class="text-text-secondary hover:text-primary transition-colors duration-200">Contact</a></li>
                    </ul>
                </div>
                
                <div>
                    <h3 class="font-semibold text-text-primary mb-4">Categories</h3>
                    <ul class="space-y-2">
                        <li><a href="#" class="text-text-secondary hover:text-primary transition-colors duration-200">Vegetables</a></li>
                        <li><a href="#" class="text-text-secondary hover:text-primary transition-colors duration-200">Fruits</a></li>
                        <li><a href="#" class="text-text-secondary hover:text-primary transition-colors duration-200">Grains</a></li>
                        <li><a href="#" class="text-text-secondary hover:text-primary transition-colors duration-200">Dairy</a></li>
                    </ul>
                </div>
                
                <div>
                    <h3 class="font-semibold text-text-primary mb-4">Support</h3>
                    <ul class="space-y-2">
                        <li><a href="#" class="text-text-secondary hover:text-primary transition-colors duration-200">Help Center</a></li>
                        <li><a href="#" class="text-text-secondary hover:text-primary transition-colors duration-200">Shipping Info</a></li>
                        <li><a href="#" class="text-text-secondary hover:text-primary transition-colors duration-200">Returns</a></li>
                        <li><a href="#" class="text-text-secondary hover:text-primary transition-colors duration-200">Privacy Policy</a></li>
                    </ul>
                </div>
            </div>
            
            <div class="border-t border-border mt-8 pt-8 text-center">
                <p class="text-text-secondary">© 2025 AgriGorithm. All Rights Reserved.</p>
            </div>
        </div>
    </footer>

    <script>
        // Mock seller data
        const mockSellers = {
            1: {
                id: 1,
                name: "Green Fields Farm",
                region: "Region 3 - Central Luzon",
                bio: "Sustainable farming practices for over 20 years. We specialize in organic vegetables and fruits, ensuring the highest quality for our customers while maintaining environmental responsibility.",
                contact: "09123456789",
                email: "greenfields@farm.ph",
                website: "www.greenfields.ph",
                avatar: "GF",
                bgColor: "from-primary-light to-primary",
                joinedDate: "2018",
                verified: true,
                rating: 4.8,
                totalSales: 1250
            },
            2: {
                id: 2,
                name: "Sunny Acres Farm",
                region: "Region 4A - CALABARZON",
                bio: "Family-owned farm specializing in organic produce. Third generation farmers committed to sustainable and traditional farming methods.",
                contact: "09234567890",
                email: "sunnyacres@farm.ph",
                avatar: "SA",
                bgColor: "from-success to-primary",
                joinedDate: "2019",
                verified: true,
                rating: 4.6,
                totalSales: 890
            }
        };

        // Mock products data
        const mockProducts = {
            1: [
                {
                    id: 1,
                    name: "Fresh Organic Tomatoes",
                    price: 4.99,
                    unit: "kg",
                    image: "https://images.unsplash.com/photo-1560493676-04071c5f467b?q=80&w=2940&auto=format&fit=crop&ixlib=rb-4.0.3",
                    category: "vegetables",
                    tags: ["organic", "fresh", "local"],
                    dateAdded: new Date('2025-01-15'),
                    inStock: true,
                    quantity: 50
                },
                {
                    id: 5,
                    name: "Organic Apples",
                    price: 5.99,
                    unit: "lb",
                    image: "https://images.unsplash.com/photo-1506905925346-21bda4d32df4?q=80&w=2940&auto=format&fit=crop&ixlib=rb-4.0.3",
                    category: "fruits",
                    tags: ["organic", "sweet", "premium"],
                    dateAdded: new Date('2025-01-11'),
                    inStock: true,
                    quantity: 30
                },
                {
                    id: 9,
                    name: "Fresh Lettuce",
                    price: 2.99,
                    unit: "head",
                    image: "https://images.unsplash.com/photo-1518977676601-b53f82aba655?q=80&w=2940&auto=format&fit=crop&ixlib=rb-4.0.3",
                    category: "vegetables",
                    tags: ["fresh", "crispy", "organic"],
                    dateAdded: new Date('2025-01-10'),
                    inStock: true,
                    quantity: 25
                },
                {
                    id: 13,
                    name: "Premium Carrots",
                    price: 3.49,
                    unit: "lb",
                    image: "https://images.unsplash.com/photo-1449824913935-59a10b8d2000?q=80&w=2940&auto=format&fit=crop&ixlib=rb-4.0.3",
                    category: "vegetables",
                    tags: ["organic", "sweet", "fresh"],
                    dateAdded: new Date('2025-01-08'),
                    inStock: true,
                    quantity: 40
                },
                {
                    id: 17,
                    name: "Organic Spinach",
                    price: 2.49,
                    unit: "bunch",
                    image: "https://images.unsplash.com/photo-1576045057995-568f588f82fb?q=80&w=2940&auto=format&fit=crop&ixlib=rb-4.0.3",
                    category: "vegetables",
                    tags: ["organic", "fresh", "healthy"],
                    dateAdded: new Date('2025-01-05'),
                    inStock: false,
                    quantity: 0
                }
            ],
            2: [
                {
                    id: 21,
                    name: "Sweet Bell Peppers",
                    price: 3.49,
                    unit: "lb",
                    image: "https://images.unsplash.com/photo-1552664730-d307ca884978?q=80&w=2940&auto=format&fit=crop&ixlib=rb-4.0.3",
                    category: "vegetables",
                    tags: ["fresh", "colorful", "organic"],
                    dateAdded: new Date('2025-01-14'),
                    inStock: true,
                    quantity: 35
                },
                {
                    id: 25,
                    name: "Cucumber",
                    price: 1.99,
                    unit: "piece",
                    image: "https://images.unsplash.com/photo-1604977042946-1eecc30f269e?q=80&w=2940&auto=format&fit=crop&ixlib=rb-4.0.3",
                    category: "vegetables",
                    tags: ["fresh", "crispy", "hydrating"],
                    dateAdded: new Date('2025-01-12'),
                    inStock: true,
                    quantity: 20
                }
            ]
        };

        let currentSeller = null;
        let currentProducts = [];
        let filteredProducts = [];

        // DOM elements
        const profileSkeleton = document.getElementById('profile-skeleton');
        const profileContent = document.getElementById('profile-content');
        const productsGrid = document.getElementById('products-grid');
        const productsSkeleton = document.getElementById('products-skeleton');
        const emptyState = document.getElementById('empty-state');
        const errorState = document.getElementById('error-state');
        const loadingIndicator = document.getElementById('loading-indicator');
        const searchInput = document.getElementById('search-products');
        const sortSelect = document.getElementById('sort-select');
        const retryBtn = document.getElementById('retry-btn');

        // Merge Sort Implementation
        function mergeSort(arr, compareFunction) {
            if (arr.length <= 1) return arr;

            const mid = Math.floor(arr.length / 2);
            const left = mergeSort(arr.slice(0, mid), compareFunction);
            const right = mergeSort(arr.slice(mid), compareFunction);

            return merge(left, right, compareFunction);
        }

        function merge(left, right, compareFunction) {
            const result = [];
            let leftIndex = 0;
            let rightIndex = 0;

            while (leftIndex < left.length && rightIndex < right.length) {
                if (compareFunction(left[leftIndex], right[rightIndex]) <= 0) {
                    result.push(left[leftIndex]);
                    leftIndex++;
                } else {
                    result.push(right[rightIndex]);
                    rightIndex++;
                }
            }

            return result.concat(left.slice(leftIndex)).concat(right.slice(rightIndex));
        }

        // Sort functions
        const sortFunctions = {
            'newest': (a, b) => b.dateAdded - a.dateAdded,
            'price-low': (a, b) => a.price - b.price,
            'price-high': (a, b) => b.price - a.price
        };

        // Get seller ID from URL
        function getSellerIdFromUrl() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('producer') || '1'; // Default to seller 1
        }

        // Initialize page
        function initializePage() {
            const sellerId = getSellerIdFromUrl();
            loadSellerData(sellerId);
        }

        // Load seller data
        function loadSellerData(sellerId) {
            setTimeout(() => {
                const seller = mockSellers[sellerId];
                
                if (!seller) {
                    showErrorState();
                    return;
                }

                currentSeller = seller;
                currentProducts = mockProducts[sellerId] || [];
                
                renderSellerProfile(seller);
                applyFiltersAndSort();
                
                // Hide skeletons
                profileSkeleton.classList.add('hidden');
                profileContent.classList.remove('hidden');
                productsSkeleton.classList.add('hidden');
            }, 1000);
        }

        // Render seller profile
        function renderSellerProfile(seller) {
            profileContent.innerHTML = `
                <div class="h-32 bg-gradient-to-br ${seller.bgColor} relative overflow-hidden">
                    <div class="absolute inset-0 bg-black bg-opacity-10"></div>
                    <div class="absolute bottom-4 left-6">
                        <div class="w-16 h-16 bg-white rounded-full flex items-center justify-center shadow-lg">
                            <span class="text-primary font-bold text-2xl">${seller.avatar}</span>
                        </div>
                    </div>
                    ${seller.verified ? `
                        <div class="absolute top-4 right-6">
                            <div class="flex items-center bg-white bg-opacity-90 text-text-primary px-3 py-1 rounded-full text-sm font-medium">
                                <svg class="w-4 h-4 mr-1 text-success" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                </svg>
                                Verified
                            </div>
                        </div>
                    ` : ''}
                </div>
                <div class="p-6">
                    <div class="flex flex-col lg:flex-row lg:items-start lg:justify-between space-y-4 lg:space-y-0">
                        <div class="flex-1 lg:mr-8">
                            <div class="flex items-center space-x-3 mb-2">
                                <h1 class="text-2xl font-bold text-text-primary">${seller.name}</h1>
                                ${seller.verified ? `
                                    <svg class="w-6 h-6 text-success" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                    </svg>
                                ` : ''}
                            </div>
                            <div class="flex items-center text-text-secondary text-sm mb-3">
                                <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
                                </svg>
                                ${seller.region}
                            </div>
                            <p class="text-text-secondary leading-relaxed mb-4">${seller.bio}</p>
                            
                            <!-- Contact Information -->
                            <div class="space-y-2">
                                <div class="flex items-center text-sm text-text-secondary">
                                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path>
                                    </svg>
                                    <span>${seller.contact}</span>
                                </div>
                                <div class="flex items-center text-sm text-text-secondary">
                                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                                    </svg>
                                    <span>${seller.email}</span>
                                </div>
                                ${seller.website ? `
                                    <div class="flex items-center text-sm text-text-secondary">
                                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9v-9m0-9v9m0 9c-5 0-9-4-9-9s4-9 9-9"></path>
                                        </svg>
                                        <span>${seller.website}</span>
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                        
                        <!-- Stats -->
                        <div class="bg-surface rounded-lg p-4 lg:w-64">
                            <h3 class="font-semibold text-text-primary mb-3">Seller Stats</h3>
                            <div class="space-y-3">
                                <div class="flex justify-between items-center">
                                    <span class="text-text-secondary text-sm">Rating</span>
                                    <div class="flex items-center space-x-1">
                                        <svg class="w-4 h-4 text-warning" fill="currentColor" viewBox="0 0 24 24">
                                            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                                        </svg>
                                        <span class="font-medium text-text-primary">${seller.rating}</span>
                                    </div>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-text-secondary text-sm">Products</span>
                                    <span class="font-medium text-text-primary">${currentProducts.length}</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-text-secondary text-sm">Total Sales</span>
                                    <span class="font-medium text-text-primary">${seller.totalSales}</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-text-secondary text-sm">Member since</span>
                                    <span class="font-medium text-text-primary">${seller.joinedDate}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Apply filters and sorting
        function applyFiltersAndSort() {
            showLoadingIndicator();
            
            setTimeout(() => {
                let filtered = [...currentProducts];
                const searchTerm = searchInput.value.toLowerCase().trim();

                // Apply search filter
                if (searchTerm) {
                    filtered = filtered.filter(product => 
                        product.name.toLowerCase().includes(searchTerm) ||
                        product.category.toLowerCase().includes(searchTerm) ||
                        product.tags.some(tag => tag.toLowerCase().includes(searchTerm))
                    );
                }

                // Apply sorting using merge sort
                const sortType = sortSelect.value;
                if (sortFunctions[sortType]) {
                    filtered = mergeSort(filtered, sortFunctions[sortType]);
                }

                filteredProducts = filtered;
                renderProducts();
                hideLoadingIndicator();
            }, 300);
        }

        // Render products
        function renderProducts() {
            if (filteredProducts.length === 0 && currentProducts.length === 0) {
                productsGrid.classList.add('hidden');
                emptyState.classList.remove('hidden');
                return;
            }

            if (filteredProducts.length === 0 && currentProducts.length > 0) {
                productsGrid.innerHTML = `
                    <div class="col-span-full text-center py-8">
                        <svg class="w-12 h-12 text-text-tertiary mx-auto mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                        </svg>
                        <h3 class="text-lg font-medium text-text-primary mb-2">No products match your search</h3>
                        <p class="text-text-secondary">Try adjusting your search terms or browse all products</p>
                    </div>
                `;
                productsGrid.classList.remove('hidden');
                emptyState.classList.add('hidden');
                return;
            }

            productsGrid.classList.remove('hidden');
            emptyState.classList.add('hidden');
            
            productsGrid.innerHTML = filteredProducts.map(product => `
                <div class="bg-surface-raised rounded-lg border border-border overflow-hidden hover:shadow-lg transition-all duration-300 transform hover:scale-105 ${!product.inStock ? 'opacity-75' : ''}">
                    <a href="product_detail_screen.html?id=${product.id}" class="block">
                        <div class="aspect-square overflow-hidden relative">
                            <img src="${product.image}" 
                                 alt="${product.name}" 
                                 class="w-full h-full object-cover transition-transform duration-300 hover:scale-110"
                                 onerror="this.src='https://images.unsplash.com/photo-1584824486509-112e4181ff6b?q=80&w=2940&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D'; this.onerror=null;">
                            ${!product.inStock ? `
                                <div class="absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center">
                                    <span class="bg-error text-white px-3 py-1 rounded-full text-sm font-medium">Out of Stock</span>
                                </div>
                            ` : ''}
                        </div>
                        <div class="p-4">
                            <h3 class="font-semibold text-text-primary mb-1 line-clamp-2">${product.name}</h3>
                            <div class="flex items-center justify-between mb-2">
                                <span class="font-bold text-primary">$${product.price.toFixed(2)}/${product.unit}</span>
                                ${product.inStock ? `
                                    <span class="text-text-tertiary text-xs">${product.quantity} available</span>
                                ` : `
                                    <span class="text-error text-xs font-medium">Out of stock</span>
                                `}
                            </div>
                            <div class="flex flex-wrap gap-1">
                                ${product.tags.slice(0, 2).map(tag => `
                                    <span class="bg-primary bg-opacity-10 text-primary px-2 py-1 rounded-full text-xs">${tag}</span>
                                `).join('')}
                                ${product.tags.length > 2 ? `<span class="text-text-tertiary text-xs">+${product.tags.length - 2}</span>` : ''}
                            </div>
                        </div>
                    </a>
                    <div class="px-4 pb-4">
                        <button class="w-full btn-primary text-sm py-2 ${!product.inStock ? 'opacity-50 cursor-not-allowed' : ''}" ${!product.inStock ? 'disabled' : ''}>
                            ${product.inStock ? 'Add to Cart' : 'Out of Stock'}
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // Show/hide loading indicator
        function showLoadingIndicator() {
            loadingIndicator.classList.remove('hidden');
        }

        function hideLoadingIndicator() {
            loadingIndicator.classList.add('hidden');
        }

        // Show error state
        function showErrorState() {
            profileSkeleton.classList.add('hidden');
            productsSkeleton.classList.add('hidden');
            errorState.classList.remove('hidden');
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            try {
                initializePage();
            } catch (error) {
                console.error('Error initializing page:', error);
                setTimeout(showErrorState, 1000);
            }

            // Sort event listener
            sortSelect.addEventListener('change', applyFiltersAndSort);
            
            // Retry button
            retryBtn.addEventListener('click', () => {
                errorState.classList.add('hidden');
                profileSkeleton.classList.remove('hidden');
                productsSkeleton.classList.remove('hidden');
                initializePage();
            });

            // Search with debounce
            let searchTimeout;
            searchInput.addEventListener('input', function() {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(applyFiltersAndSort, 300);
            });
        });
    </script>

<script id="dhws-dataInjector" src="../public/dhws-data-injector.js"></script>
<script id="dhws-elementInspector" src="../public/dhws-web-inspector.js"></script>
<script id="dhws-errorTracker" src="../public/dhws-error-tracker.js"></script>
</body>
</html>